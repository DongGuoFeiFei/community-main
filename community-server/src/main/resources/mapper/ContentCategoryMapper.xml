<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.communityserver.mapper.ContentCategoryMapper">

    <!-- 树形结构映射 -->
    <resultMap id="CategoryTreeMap" type="com.example.communityserver.entity.response.ContentCategoryTree">
        <id column="category_id" property="id"/>
        <result column="parent_id" property="parentId"/>
        <result column="category_name" property="categoryName"/>
        <result column="category_slug" property="categorySlug"/>
        <result column="description" property="description"/>
        <result column="cover_url" property="coverUrl"/>
        <result column="sort_order" property="sortOrder"/>
        <result column="status" property="status"/>
        <result column="article_count" property="articleCount"/>
        <result column="created_at" property="createdAt"/>
        <result column="updated_at" property="updatedAt"/>
        <result column="is_del" property="isDel"/>
        <collection property="categoryList"
                    column="category_id"
                    select="selectChildrenCategories"
                    javaType="java.util.List"/>
    </resultMap>

    <!-- 查询所有顶级分类 -->
    <select id="getCategoryTrees" resultMap="CategoryTreeMap">
        SELECT *
        FROM content_category
        WHERE parent_id IS NULL
          AND status = 1
          AND is_del = 0
        ORDER BY sort_order DESC, category_id ASC
    </select>

    <!-- 查询子分类（支持多级递归） -->
    <select id="selectChildrenCategories" resultMap="CategoryTreeMap">
        SELECT
            *
        FROM content_category
        WHERE parent_id = #{category_id}
          AND status = 1
          AND is_del = 0
        ORDER BY sort_order DESC, category_id ASC
    </select>

</mapper>